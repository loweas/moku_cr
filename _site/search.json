[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "moku",
    "section": "",
    "text": "Recreation by Moku\nThe following code estimates annual value of coral reef in 2024 dollars by Moku. We use the Economic Model from Fezzi, Ford, and Oleson (2023). We use recreational sites across the islands with amenities and condition (coral reef and fish biomass). Using compensating variation we estimate the annual welfare driven by the percentage of coral reef in each Moku for all identified recreational sites.\n\n\nRunning Code\nThis section calls the necessary R packages and sources external scripts from the original study. These scripts provide the estimated coefficients from the Random Utility Model (RUM), which will be used to simulate individual preferences and estimate welfare. These parameters reflect the marginal utility of various site attributes, including coral reef biomass, travel cost, and environmental conditions.\n\n\nShow code\nlibrary(dplyr)\n\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\n\nShow code\nlibrary(tidyr)\nlibrary(ggplot2)\n\n\nWarning: package 'ggplot2' was built under R version 4.3.3\n\n\nShow code\nlibrary(sf)\n\n\nWarning: package 'sf' was built under R version 4.3.3\n\n\nLinking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE\n\n\nShow code\nlibrary(gganimate)\n\n\nWarning: package 'gganimate' was built under R version 4.3.3\n\n\nShow code\n### load functions\n\ngetwd()\n\n\n[1] \"/Users/ashleylowe/Workspace/moku\"\n\n\nShow code\nsource(\"codedata/dummier.R\")\nsource(\"codedata/travel_cost.R\")\nsource(\"codedata/gridplot.R\")\n\n### load model ###\n\nload(file = \"codedata/model3.mod\")\n\n### this are the travel cost model estimates ###\n\nm1\n\n\n$results\n                   Estimate Std.Error t-value p-value\ncost               -0.07618   0.00168 -45.369  0.0000\nhome                5.66637   0.12922  43.851  0.0000\ncoastal            -0.66774   0.19326  -3.455  0.0005\ncitypark           -0.78030   0.16285  -4.791  0.0000\ntrailall            0.70325   0.15004   4.687  0.0000\nhaleakala           4.65179   0.24724  18.815  0.0000\nmolokini            4.48925   0.53133   8.449  0.0000\nparking             1.17803   0.07392  15.936  0.0000\nshowers             0.59104   0.06156   9.601  0.0000\nlifeguard           0.08591   0.06657   1.291  0.1968\nrock               -1.26640   0.15266  -8.295  0.0000\nmanmade            -0.96971   0.18507  -5.240  0.0000\nbeachmedium         0.11700   0.06968   1.679  0.0931\nbeachlarge          0.32178   0.07486   4.298  0.0000\nsurf               -0.28922   0.05674  -5.097  0.0000\nswim                0.13087   0.07848   1.668  0.0954\nsnork               0.27150   0.11923   2.277  0.0228\nres_fish_bio        0.03664   0.00357  10.251  0.0000\nPNAS                0.00841   0.00741   1.135  0.2565\nplayground          0.72257   0.06143  11.762  0.0000\nsports              0.38978   0.07058   5.523  0.0000\nsnork:PNAS          0.01968   0.00816   2.412  0.0159\nsnork:res_fish_bio  0.00598   0.00446   1.342  0.1797\n\n$logLik\n[1] -17021.26\n\n$pseudoR2\n[1] 0.6505\n\n\n\n\nShow code\nx1 &lt;- readRDS(\"codedata/x1.rds\")\nx1$coastal[x1$name == \"Home\"]=0 \n\n### Prepared dataset for maps plot:\n\nout &lt;- x1[order(x1$siteID),]\nout &lt;- out[c(1,3,6,7,8:12)]\nout=out[!duplicated(out[2]),]\n\n##using 85K because that was the survey amount\nout$incometran_track=out$medincome_tract/85000\nsites_join &lt;- read.csv(\"codedata/sites_join.csv\")\ncoasts &lt;- sites_join[sites_join$coastal == 1 & sites_join$name!=\"Home\",]\n\n\n\n\nMerge\nThis file merges distance and sites from across the islands. The distance are based on kilometer grid and sites were determined across island.\n\n\nMoku\n\n\nShow code\nlibrary(sf)\nlibrary(leaflet)\nsites&lt;-  read.csv(\"codedata/all_sites_wCoralFish.csv\")\nsites &lt;- sites[sites$name!=\"Home\",]\nmoku &lt;- st_read(\"moku_ridge_to_reef_dar.shp/moku_ridge_to_reef_dar.shp\")\n\n\nReading layer `moku_ridge_to_reef_dar' from data source \n  `/Users/ashleylowe/Workspace/moku/moku_ridge_to_reef_dar.shp/moku_ridge_to_reef_dar.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 34 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 366289.9 ymin: 2089415 xmax: 945103.9 ymax: 2463789\nProjected CRS: NAD83(HARN) / UTM zone 4N\n\n\nShow code\nmoku &lt;- st_transform(moku, crs = 4326)\n# Convert to spatial data\nsites_sf &lt;- st_as_sf(sites, coords = c(\"longitude\",\"latitude\"), crs = 4326)\nsites_sf$name &lt;- iconv(sites_sf$name, from = \"\", to = \"UTF-8\", sub = \"byte\")\nleaflet() %&gt;%\n  addProviderTiles(\"Esri.WorldTopoMap\") %&gt;%   # nice basemap\n  addPolygons(\n    data = moku,\n    color = \"blue\",\n    weight = 2,\n    fillOpacity = 0.2,\n    popup = ~Moku                       \n  ) %&gt;%\n  addCircleMarkers(\n    data = sites_sf,\n    radius = 1,\n    color = \"red\",\n    fillOpacity = 0.8,\n    popup = ~paste0(\"Site: \", name) \n  )\n\n\n\n\n\n\n\n\nCV\n\n\nShow code\n# Join moku\nsites_sf &lt;- st_join(sites_sf, moku[\"Moku\"])\n\nsites_sf=sites_sf[c(1,31)] %&gt;%\n  st_drop_geometry() %&gt;%      # remove geometry for pivoting\n  mutate(value = 0) %&gt;%       # create dummy flag\n  pivot_wider(\n    names_from = Moku,\n    values_from = value,\n    values_fill = 1           # fill unassigned Mokū with 0\n  )\n\nx1=merge(x1,sites_sf, by.y = \"object_id_final\", by.x = \"siteID\", all.y = TRUE)\n\n\n\n\nShow code\n### parameters\n\nbeta &lt;- m1$results[,1]\n\nx1 &lt;- x1[order(x1$km2_ID,x1$siteID),]   ## btw it is correct that the dim(x) is lower than dim(dist) because\n## I aggregated some sites\nlength(unique(x1$siteID))\n\n\n[1] 444\n\n\nShow code\n### FINISHED LOADING AND MERGING DATASETS ###\n\n#rm(dist, pop, sitesjoin)\n\n### CALCULATE TRAVEL COST ####\n\nx1$cost &lt;- 0\nx1$duration[ x1$siteID == 351] &lt;- x1$duration[ x1$siteID == 351] + 40       ## this sites needs 40min walking to be reached\n## Need to also do this for Hawaii\n### Change here for different fuel cost\nx1$cost &lt;- x1$distance.meters*0.001 * (0.20 / 1.5   )               ## fuel cost \n## assumption on fuel cost:\n#\n# 20 miles/gallon\n# $4.3/gallon\n# means $4.3 per 20 miles --&gt; 0.215 $/mile\n# 10 km --&gt; 6.2 miles --&gt; $1.33 travel cost per km\n# 10km * 0.20 / 1.5 = $1.33  so the values coincide with the cost used above.\nx1$cost &lt;- x1$cost + (x1$duration / 60)* 3/4 * 24.14    ## add the value of time (assuming a 25$ per hour average wage rate)\nx1$cost &lt;- x1$cost * 2                          ## the value for a return trip\n#### put Molokini cost equal to the one of Makena Landing Beach Park + 100$ (cost of a snorkeling tour)\nx1$cost[x1$siteID == 388] &lt;- x1$cost[x1$siteID == 359] + 100\n\n\n### Considering a transfer to Oahu:\n#x1[is.na(x1)] &lt;- 0\nx1[1, is.na(x1[1, ])] &lt;- 0\n\n\nX0 &lt;- cbind( x1$cost,x1$home, x1$coastal, x1$citypark, x1$trailall,\n             x1$haleakala, x1$molokini, x1$parking, x1$showers,\n             x1$lifeguard, x1$rock, x1$manmade, x1$beachmedium, x1$beachlarge, x1$surf,\n             x1$swim, x1$snork, x1$res_fish_bio, x1$PNAS, x1$playground, x1$sports,\n             x1$snork*x1$PNAS, x1$snork*x1$res_fish_bio)\n\nX0[is.na(X0)] &lt;- 0\n\n\nxsim &lt;- x1\n\n\n\n\nShow code\nfinal &lt;- data.frame(matrix(ncol =2, nrow = 0))\nall &lt;- data.frame(matrix(ncol =2, nrow = 0))\n\n#this needs to be ran as a loop\nfor (i in 46:70) {\n  xsim &lt;- x1\n  xsim$PNAS &lt;- xsim$PNAS *xsim[,i]\n  xsim$PNAS[xsim$PNAS &lt;= 0] &lt;- 0\n  \n  X1 &lt;- cbind( xsim$cost,xsim$home, xsim$coastal, xsim$citypark, xsim$trailall,\n               xsim$haleakala, xsim$molokini, xsim$parking, xsim$showers,\n               xsim$lifeguard, xsim$rock, xsim$manmade, xsim$beachmedium, xsim$beachlarge, xsim$surf,\n               xsim$swim, xsim$snork, xsim$res_fish_bio, xsim$PNAS, xsim$playground, xsim$sports,\n               xsim$snork*xsim$PNAS, xsim$snork*xsim$res_fish_bio)\n  \n  X1[is.na(X1)] &lt;- 0\n  \n### CALCULATION OF WTP FOR EACH GRID LOCATION\n  \nwtpw &lt;- quality.change(beta = beta, ### parameters\n                         X0=X0,     ### X variables in the baseline\n                         X1 = X1,   #### X variables in the scenario\n                         pid = x1$km2_ID,    ### ID of the 1km grid\n                         cost =1)       ### column of the cost parameter in the X matrix\n  \n  ### TOTAL WTP\n  \n  b=merge(wtpw,out, by.x=c(\"id\"),by.y=c(\"km2_ID\"))\n  b$Num=i\n  b$Moku= colnames(xsim)[i]\n\n  all=rbind(b,all)\n}\n  moku_wtp=all %&gt;% group_by(island, Moku) %&gt;% summarize(WTP_Moku=sum(WTP * incometran_track*grid_km_censusblock_Pop18_densityKM * 365)/100000\n  )\n\n\n`summarise()` has grouped output by 'island'. You can override using the\n`.groups` argument.\n\n\nShow code\nhead(moku_wtp)\n\n\n# A tibble: 6 × 3\n# Groups:   island [1]\n  island Moku        WTP_Moku\n  &lt;fct&gt;  &lt;chr&gt;          &lt;dbl&gt;\n1 Hawaii Haleleʻa        0   \n2 Hawaii Hilo         -553.  \n3 Hawaii Honuaʻula       0   \n4 Hawaii Hāmākua        -1.16\n5 Hawaii Hāmākualoa      0   \n6 Hawaii Hāmākuapoko     0   \n\n\n\n\nShow code\nlibrary(sf)\nlibrary(leaflet)\nlibrary(dplyr)\n\n# Load your Moku shapefile\nmoku &lt;- st_read(\"moku_ridge_to_reef_dar.shp/moku_ridge_to_reef_dar.shp\")\n\n\nReading layer `moku_ridge_to_reef_dar' from data source \n  `/Users/ashleylowe/Workspace/moku/moku_ridge_to_reef_dar.shp/moku_ridge_to_reef_dar.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 34 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 366289.9 ymin: 2089415 xmax: 945103.9 ymax: 2463789\nProjected CRS: NAD83(HARN) / UTM zone 4N\n\n\nShow code\n# Make sure it’s in WGS84 for leaflet\nmoku &lt;- st_transform(moku, 4326)\n\nmoku_wtp=all %&gt;% group_by(island, Moku) %&gt;% summarize(WTP_Moku=sum((WTP * incometran_track*grid_km_censusblock_Pop18_densityKM * 365)/-100000)*1.249\n  )\n\n\n`summarise()` has grouped output by 'island'. You can override using the\n`.groups` argument.\n\n\nShow code\nmoku_wtp$island &lt;- as.character(moku_wtp$island)\nmoku_wtp$island[which(moku_wtp$island==\"Oahu\")]=\"Oʻahu\"\nmoku_wtp$island[which(moku_wtp$island==\"Molokai\")]=\"Molokaʻi\"\nmoku_wtp$island[which(moku_wtp$island==\"Lanai\")]=\"Lānaʻi\"\nmoku_wtp$island[which(moku_wtp$island==\"Kauai\")]=\"Kauaʻi\"\nmoku_wtp$island[which(moku_wtp$island==\"Hawaii\")]=\"Hawaiʻi\"\n\nmoku=merge(moku,moku_wtp, by.x=c(\"Moku\",\"Mokupuni\"),by.y=c(\"Moku\",\"island\"))\n\n\n\n\nMap\n\n\nShow code\n# Option 1: Log-transform for skewed data\nmoku$WTP_Moku_log &lt;- log1p(moku$WTP_Moku) # log(1 + x) avoids log(0)\n\n# Define color palette\npal &lt;- colorNumeric(\n  palette = \"viridis\",      # perceptually uniform color scale\n  domain = moku$WTP_Moku_log\n)\n\nleaflet(moku) %&gt;%\n  addProviderTiles(\"Esri.WorldTopoMap\") %&gt;%\n  addPolygons(\n    fillColor = ~pal(WTP_Moku_log),\n    color = \"black\",\n    weight = 1,\n    fillOpacity = 0.8,\n    popup = ~paste0(\n      \"&lt;strong&gt;Moku: &lt;/strong&gt;\", Moku, \"&lt;br&gt;\",\n      \"&lt;strong&gt;Annual Welfare Moku: &lt;/strong&gt;\", round(WTP_Moku, 2)\n    )\n  ) %&gt;%\n  addLegend(\n    \"bottomright\",\n    pal = pal,\n    values = ~WTP_Moku_log,\n    title = \"Annual &lt;br&gt; Moku Welfare in Millions\",\n    opacity = 0.7,\n    labFormat = labelFormat(transform = function(x) round(expm1(x), 0)) # revert log for labels\n  )\n\n\n\n\n\n\n\n\nTable\n\n\nShow code\nlibrary(dplyr)\nlibrary(gt)\n\n\nWarning: package 'gt' was built under R version 4.3.3\n\n\nShow code\nlibrary(sf)\n\n# Drop geometry and sort by Island\nmoku_table &lt;- moku %&gt;%\n  st_drop_geometry() %&gt;%             # remove geometry\n  select(Island = Mokupuni, Moku, WTP_Moku) %&gt;%  # select relevant columns\n  arrange(Island)                     # sort by Island\n\n# Create pretty table\nmoku_table %&gt;%\n  gt() %&gt;%\n  tab_header(\n    title = \"Annual WTP millions in 2024$ &lt;br&gt; by Moku and Island\"\n  ) %&gt;%\n  fmt_number(\n    columns = vars(WTP_Moku),\n    decimals = 2\n  ) %&gt;%\n  data_color(\n    columns = vars(WTP_Moku),\n    colors = scales::col_numeric(\n      palette = c(\"lightyellow\", \"orange\", \"red\"),\n      domain = moku_table$WTP_Moku\n    )\n  ) %&gt;%\n  cols_label(\n    Island = \"Island\",\n    Moku = \"Moku\",\n    WTP_Moku = \"Annual Value in Millions\"\n  ) %&gt;%\n  tab_style(\n    style = cell_text(weight = \"bold\"),\n    locations = cells_column_labels(everything())\n  )\n\n\nWarning: Since gt v0.3.0, `columns = vars(...)` has been deprecated.\n• Please use `columns = c(...)` instead.\n\n\nWarning: Since gt v0.9.0, the `colors` argument has been deprecated.\n• Please use the `fn` argument instead.\nThis warning is displayed once every 8 hours.\n\n\nWarning: Since gt v0.3.0, `columns = vars(...)` has been deprecated.\n• Please use `columns = c(...)` instead.\n\n\n\n\n\n\n\n\nAnnual WTP millions in 2024$ &lt;br&gt; by Moku and Island\n\n\nIsland\nMoku\nAnnual Value in Millions\n\n\n\n\nHawaiʻi\nHāmākua\n1.45\n\n\nHawaiʻi\nHilo\n690.81\n\n\nHawaiʻi\nKaʻū\n17.77\n\n\nHawaiʻi\nKohala\n358.21\n\n\nHawaiʻi\nKona\n969.61\n\n\nHawaiʻi\nPuna\n60.33\n\n\nKauaʻi\nHaleleʻa\n48.58\n\n\nKauaʻi\nKoʻolau\n26.48\n\n\nKauaʻi\nKona\n57.42\n\n\nKauaʻi\nNāpali\n0.09\n\n\nKauaʻi\nPuna\n147.65\n\n\nLānaʻi\nLānaʻi\n18.29\n\n\nMaui\nHāmākualoa\n18.30\n\n\nMaui\nHāmākuapoko\n303.90\n\n\nMaui\nHāna\n37.64\n\n\nMaui\nHonuaʻula\n246.50\n\n\nMaui\nKāʻanapali\n231.18\n\n\nMaui\nKaupō\n0.73\n\n\nMaui\nKïpahulu\n0.06\n\n\nMaui\nKoʻolau\n2.01\n\n\nMaui\nKula\n378.85\n\n\nMaui\nLāhainā\n266.93\n\n\nMaui\nPūʻali Komohana\n322.79\n\n\nMolokaʻi\nKoʻolau\n5.53\n\n\nMolokaʻi\nKona\n9.39\n\n\nOʻahu\nʻEwa\n1,290.18\n\n\nOʻahu\nKoʻolauloa\n1,097.67\n\n\nOʻahu\nKoʻolaupoko\n4,040.25\n\n\nOʻahu\nKona\n365.57\n\n\nOʻahu\nWaialua\n111.55\n\n\nOʻahu\nWaiʻanae\n584.78\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nReferences\n\nFezzi, Carlo, Derek J. Ford, and Kirsten L. L. Oleson. 2023. “The Economic Value of Coral Reefs: Climate Change Impacts and Spatial Targeting of Restoration Measures.” Ecological Economics 203 (January): 107628. https://doi.org/10.1016/j.ecolecon.2022.107628."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  }
]